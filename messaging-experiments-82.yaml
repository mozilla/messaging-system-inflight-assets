- id: bug-1661707-homepage-remediation-search-value
  application: firefox-desktop
  probeSets: []
  startDate:
  endDate:
  proposedEnrollment: 7
  referenceBranch: control
  arguments:
    slug: bug-1661707-homepage-remediation-search-value
    isEnrollmentPaused: false
    userFacingName: 'Homepage Remediation: Search Value Props Experiment'
    userFacingDescription: This experiment promotes the default Firefox homepage configuration
      for users that switched away from it. We want to communicate the recent improvements
      that should lead to a better user experience.
    bucketConfig:
      namespace: messaging-experiments-cfr
      randomizationUnit: normandy_id
      start: 5312
      count: 1000
      total: 10000
    branches:
      - slug: treatment-a
        ratio: 1
        feature:
          featureId: cfr
          enabled: true
          value:
            id: 'bug-1661707-homepage-remediation-search-value:treatment-a'
            # Workaround for bug 1671149
            group:
              - cfr
            # This links the message with the daily group frequency cap defined
            # here: https://github.com/mozilla/messaging-system-inflight-assets/blob/3b9db1ec2c437c4c954213ac11a457264c3492e3/message-groups.json#L16
            groups:
              - cfr-experiments
            frequency:
              lifetime: 3
            # Has google set as the homepage, has CFR features enabled, has profile
            # older than 6 months
            targeting: "!homePageSettings.isDefault && homePageSettings.isCustomUrl && homePageSettings.urls[.host == 'google.com']|length > 0 && visitsCount >= 3 && userPrefs.cfrFeatures && currentDate|date - profileAgeCreated > 15770000000"
            template: cfr_doorhanger
            content:
              layout: icon_and_message
              text: Keep using your favorite search and your normal web browsing will help us keep Firefox free. Would you like to update your homepage?
              icon: chrome://browser/skin/preferences/search.svg
              buttons:
                secondary:
                  - label:
                      string_id: cfr-doorhanger-extension-cancel-button
                    action:
                      type: CANCEL
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
                    action:
                      type: OPEN_PREFERENCES_PAGE
                      data:
                        category: general-cfrfeatures
                primary:
                  label:
                    value: Update Homepage
                    attributes:
                      accesskey: U
                  action:
                    type: CONFIGURE_HOMEPAGE
                    data:
                      homePage: default
                      newtab: default
                      layout:
                        search: true
                        topsites: false
                        highlights: false
                        topstories: false
                        snippets: false
              bucket_id: 'bug-1661707-homepage-remediation-search-value:treatment-a'
              heading_text: Same great search, keep Firefox free
              info_icon:
                label:
                  string_id: cfr-doorhanger-extension-sumo-link
                sumo_path: extensionrecommendations
              notification_text:
                string_id: cfr-doorhanger-feature-notification
              category: cfrFeatures
            trigger:
              id: openURL
              params:
                - google.com
                - www.google.com
      - slug: treatment-b
        ratio: 1
        feature:
          featureId: cfr
          enabled: true
          value:
            id: 'bug-1661707-homepage-remediation-search-value:treatment-b'
            # Workaround for bug 1671149
            group:
              - cfr
            # This links the message with the daily group frequency cap defined
            # here: https://github.com/mozilla/messaging-system-inflight-assets/blob/3b9db1ec2c437c4c954213ac11a457264c3492e3/message-groups.json#L16
            groups:
              - cfr-experiments
            frequency:
              lifetime: 3
            # Has google set as the homepage, has CFR features enabled, has profile
            # older than 6 months
            targeting: "!homePageSettings.isDefault && homePageSettings.isCustomUrl && homePageSettings.urls[.host == 'google.com']|length > 0 && visitsCount >= 3 && userPrefs.cfrFeatures && currentDate|date - profileAgeCreated > 15770000000"
            template: cfr_doorhanger
            content:
              layout: icon_and_message
              text: 'Keep using your favorite search and ####. Would you like to update your homepage?'
              icon: chrome://browser/skin/preferences/search.svg
              buttons:
                secondary:
                  - label:
                      string_id: cfr-doorhanger-extension-cancel-button
                    action:
                      type: CANCEL
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
                    action:
                      type: OPEN_PREFERENCES_PAGE
                      data:
                        category: general-cfrfeatures
                primary:
                  label:
                    value: Update Homepage
                    attributes:
                      accesskey: U
                  action:
                    type: CONFIGURE_HOMEPAGE
                    data:
                      homePage: default
                      newtab: default
                      layout:
                        search: true
                        topsites: true
                        highlights: false
                        topstories: false
                        snippets: false
              bucket_id: 'bug-1661707-homepage-remediation-search-value:treatment-b'
              heading_text: 'Same great search, ####'
              info_icon:
                label:
                  string_id: cfr-doorhanger-extension-sumo-link
                sumo_path: extensionrecommendations
              notification_text:
                string_id: cfr-doorhanger-feature-notification
              category: cfrFeatures
            trigger:
              id: openURL
              params:
                - google.com
                - www.google.com
      - slug: treatment-c
        ratio: 1
        feature:
          featureId: cfr
          enabled: true
          value:
            id: 'bug-1661707-homepage-remediation-search-value:treatment-c'
            # Workaround for bug 1671149
            group:
              - cfr
            # This links the message with the daily group frequency cap defined
            # here: https://github.com/mozilla/messaging-system-inflight-assets/blob/3b9db1ec2c437c4c954213ac11a457264c3492e3/message-groups.json#L16
            groups:
              - cfr-experiments
            frequency:
              lifetime: 3
            # Has google set as the homepage, has CFR features enabled, has profile
            # older than 6 months
            targeting: "!homePageSettings.isDefault && homePageSettings.isCustomUrl && homePageSettings.urls[.host == 'google.com']|length > 0 && visitsCount >= 3 && userPrefs.cfrFeatures && currentDate|date - profileAgeCreated > 15770000000"
            template: cfr_doorhanger
            content:
              layout: icon_and_message
              text: Update your homepage to search Google while also being able to search your
                Firefox history and bookmarks.
              icon: chrome://browser/skin/preferences/search.svg
              buttons:
                secondary:
                  - label:
                      string_id: cfr-doorhanger-extension-cancel-button
                    action:
                      type: CANCEL
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
                    action:
                      type: OPEN_PREFERENCES_PAGE
                      data:
                        category: general-cfrfeatures
                primary:
                  label:
                    value: Activate now
                    attributes:
                      accesskey: A
                  action:
                    type: CONFIGURE_HOMEPAGE
                    data:
                      homePage: default
                      newtab: default
                      layout:
                        search: true
                        topsites: true
                        highlights: true
                        topstories: true
                        snippets: true
              bucket_id: 'bug-1661707-homepage-remediation-search-value:treatment-c'
              heading_text: A better search experience
              info_icon:
                label:
                  string_id: cfr-doorhanger-extension-sumo-link
                sumo_path: extensionrecommendations
              notification_text:
                string_id: cfr-doorhanger-feature-notification
              category: cfrFeatures
            trigger:
              id: openURL
              params:
                - google.com
                - www.google.com
      - slug: control
        ratio: 1
        feature:
          featureId: cfr
          enabled: true
          value: {}
  targeting: browserSettings.update.channel == 'release' &&
    localeLanguageCode == 'en' && region == 'US' &&
    'app.shield.optoutstudies.enabled'|preferenceValue
- id: MULTI-STAGE-ABOUTWELCOME-ZERO-STAGE
  enabled: true
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: firefoxVersion >= '82.' && browserSettings.update.channel != 'release' && localeLanguageCode == "en" && ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1668928-message-multi-stage-aboutwelcome-zero-stage-release-82-83' in activeExperiments)
  arguments:
    slug: bug-1668928-message-multi-stage-aboutwelcome-zero-stage-release-82-83
    startDate:
    endDate:
    proposedEnrollment: 7
    referenceBranch: "control"
    bucketConfig:
      count: 2000
      start: 0
      total: 10000
      namespace: bug-1668928-message-multi-stage-aboutwelcome-zero-stage-release-82-83
      randomizationUnit: normandy_id
    userFacingName: "Multi-Stage About:Welcome Zero Stage"
    userFacingDescription: Study to validate a minimal onboarding experience
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        feature:
          featureId: "aboutwelcome"
          enabled: false
          value: null
      - slug: treatment-default
        ratio: 1
        feature:
          featureId: "aboutwelcome"
          enabled: true
          value: {}
      - slug: treatment-no-titles
        ratio: 1
        feature:
          featureId: "aboutwelcome"
          enabled: true
          value:
            id: msw-no-titles
            template: multistage
            screens:
              - id: "AW_GET_STARTED"
                order: 0
                content:
                  zap: true
                  title: Welcome to Firefox
                  subtitle: The fast, safe, and private browser that's backed by a non-profit.
                  primary_button:
                    label: Start Setup
                    action:
                      navigate: true
                  secondary_button:
                    text: Have an account?
                    label: Sign in
                    position: top
                    action:
                      type: SHOW_FIREFOX_ACCOUNTS
                      addFlowParams: true
                      data:
                        entrypoint: activity-stream-firstrun
              - id: "AW_IMPORT_SETTINGS"
                order: 1
                content:
                  zap: true
                  title: Import your passwords, bookmarks, and more
                  subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                  tiles:
                    type: topsites
                    showTitles: false
                  primary_button:
                    label: Start Import
                    action:
                      navigate: true
                      type: SHOW_MIGRATION_WIZARD
                  secondary_button:
                    label: Not now
                    action:
                      navigate: true
              - id: "AW_CHOOSE_THEME"
                order: 2
                content:
                  zap: true
                  title: Choose a look
                  subtitle: Personalize Firefox with a theme.
                  tiles:
                    type: theme
                    action:
                      theme: <event>
                    data:
                      - theme: automatic
                        label: Automatic
                        tooltip:
                          string_id: onboarding-multistage-theme-tooltip-automatic-2
                        description:
                          string_id: onboarding-multistage-theme-tooltip-automatic-2
                      - theme: light
                        label: Light
                        tooltip:
                          string_id: onboarding-multistage-theme-tooltip-light-2
                        description:
                          string_id: onboarding-multistage-theme-tooltip-light-2
                      - theme: dark
                        label: Dark
                        tooltip:
                          string_id: onboarding-multistage-theme-tooltip-dark-2
                        description:
                          string_id: onboarding-multistage-theme-tooltip-dark-2
                      - theme: alpenglow
                        label: Alpenglow
                        tooltip:
                          string_id: onboarding-multistage-theme-tooltip-alpenglow-2
                        description:
                          string_id: onboarding-multistage-theme-tooltip-alpenglow-2
                  primary_button:
                    label: Save Theme
                    action:
                      navigate: true
                  secondary_button:
                    label: Not now
                    action:
                      navigate: true
                      theme: automatic
  slug: bug-1668928-message-multi-stage-aboutwelcome-zero-stage-release-82-83
  isEnrollmentPaused: false
  probeSets: []
  startDate: null
  endDate: null
  proposedEnrollment: 7
  referenceBranch: control
  application: firefox-desktop
  bucketConfig:
    namespace: bug-1668928-message-multi-stage-aboutwelcome-zero-stage-release-82-83
    randomizationUnit: normandy_id
    start: 0
    count: 2000
    total: 10000
  userFacingName: "Multi-Stage About:Welcome Zero Stage"
  userFacingDescription: Study to validate with a minimal onboarding experience
  branches:
    - slug: control
      ratio: 1
      feature:
        featureId: "aboutwelcome"
        enabled: false
        value: null
    - slug: treatment-default
      ratio: 1
      feature:
        featureId: "aboutwelcome"
        enabled: true
        value: {}
    - slug: treatment-no-titles
      ratio: 1
      feature:
        featureId: "aboutwelcome"
        enabled: true
        value:
          id: msw-no-titles
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: SHOW_FIREFOX_ACCOUNTS
                    addFlowParams: true
                    data:
                      entrypoint: activity-stream-firstrun
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                zap: true
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles:
                  type: topsites
                  showTitles: false
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
            - id: "AW_CHOOSE_THEME"
              order: 2
              content:
                zap: true
                title: Choose a look
                subtitle: Personalize Firefox with a theme.
                tiles:
                  type: theme
                  action:
                    theme: <event>
                  data:
                    - theme: automatic
                      label: Automatic
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-automatic-2
                      description:
                        string_id: onboarding-multistage-theme-tooltip-automatic-2
                    - theme: light
                      label: Light
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-light-2
                      description:
                        string_id: onboarding-multistage-theme-tooltip-light-2
                    - theme: dark
                      label: Dark
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-dark-2
                      description:
                        string_id: onboarding-multistage-theme-tooltip-dark-2
                    - theme: alpenglow
                      label: Alpenglow
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-alpenglow-2
                      description:
                        string_id: onboarding-multistage-theme-tooltip-alpenglow-2
                primary_button:
                  label: Save Theme
                  action:
                    navigate: true
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
                    theme: automatic
