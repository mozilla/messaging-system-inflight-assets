- id: MILESTONE_MESSAGE
  groups:
    - cfr
  content:
    anchor_id: tracking-protection-icon-box
    bucket_id: CFR_MILESTONE_MESSAGE
    buttons:
      primary:
        action:
          type: OPEN_PROTECTION_REPORT
        event: PROTECTION
        label:
          string_id: cfr-doorhanger-milestone-ok-button
      secondary:
        - label:
            string_id: "cfr-doorhanger-milestone-close-button"
          action:
            type: "CANCEL"
          event: "DISMISS"
    category: cfrFeatures
    heading_text:
      string_id: cfr-doorhanger-milestone-heading
    layout: short_message
    notification_text: ''
    skip_address_bar_notifier: true
    text: ''
  frequency:
    lifetime: 7
  targeting: pageLoad >= 4 && firefoxVersion < 87 && userPrefs.cfrFeatures
  template: milestone_message
  trigger:
    id: contentBlocking
    params:
      - ContentBlockingMilestone
- id: MILESTONE_MESSAGE_87
  groups:
    - cfr
  content:
    anchor_id: tracking-protection-icon-box
    bucket_id: CFR_MILESTONE_MESSAGE
    buttons:
      primary:
        action:
          type: OPEN_PROTECTION_REPORT
        event: PROTECTION
        label:
          string_id: cfr-doorhanger-milestone-ok-button
      secondary:
        - label:
            string_id: "cfr-doorhanger-milestone-close-button"
          action:
            type: "CANCEL"
          event: "DISMISS"
    category: cfrFeatures
    heading_text:
      string_id: cfr-doorhanger-milestone-heading2
    layout: short_message
    notification_text: ''
    skip_address_bar_notifier: true
    text: ''
  frequency:
    lifetime: 7
  targeting: pageLoad >= 4 && firefoxVersion >= 87 && userPrefs.cfrFeatures
  template: milestone_message
  trigger:
    id: contentBlocking
    params:
      - ContentBlockingMilestone
- id: DOH_ROLLOUT_CONFIRMATION_89
  groups:
    - cfr
  targeting: >-
    (
    'doh-rollout.enabled'|preferenceValue ||
    'doh-rollout.self-enabled'|preferenceValue ||
    'doh-rollout.ru.enabled'|preferenceValue ||
    'doh-rollout.ua.enabled'|preferenceValue
    ) &&
    !(
    'doh-rollout.disable-heuristics'|preferenceValue ||
    'doh-rollout.skipHeuristicsCheck'|preferenceValue ||
    'doh-rollout.doorhanger-decision'|preferenceValue
    ) &&
    firefoxVersion >= 89
  template: infobar
  content:
    priority: 3
    type: global
    text:
      string_id: cfr-doorhanger-doh-body
    buttons:
      - label:
          string_id: cfr-doorhanger-doh-primary-button-2
        action:
          type: ACCEPT_DOH
        primary: true
      - label:
          string_id: cfr-doorhanger-doh-secondary-button
        action:
          type: DISABLE_DOH
      - label:
          string_id: notification-learnmore-default-label
        supportPage: dns-over-https
        # Use no callback/action so telemetry doesn't mix link and secondary
        callback: null
        action:
          type: CANCEL
    bucket_id: DOH_ROLLOUT_CONFIRMATION_89
    category: cfrFeatures
  frequency:
    lifetime: 3
  trigger:
    id: openURL
    patterns:
      - "*://*/*"
- id: INFOBAR_DEFAULT_AND_PIN_87
  groups:
    - cfr
  content:
    category: cfrFeatures
    bucket_id: INFOBAR_DEFAULT_AND_PIN_87
    text:
      string_id: default-browser-notification-message
    type: global
    buttons:
      - label:
          string_id: default-browser-notification-button
        action:
          type: PIN_AND_DEFAULT
        primary: true
        accessKey: P
  trigger:
    id: defaultBrowserCheck
  template: infobar
  frequency:
    lifetime: 2
    custom:
      - period: 3024000000  # 86400000 * 35 (35 days to ms)
        cap: 1
  # Not default browser and user dismissed the default browser prompt
  # For Firefox version 87-88 the message is triggered only on the newtab page.
  # For versions 89+ we trigger the message at startup and want to ignore the
  # newtab trigger.
  targeting:
    "((firefoxVersion >= 87 && firefoxVersion < 89) || (firefoxVersion >= 89 && source == 'startup')) && !isDefaultBrowser && !'browser.shell.checkDefaultBrowser'|preferenceValue && isMajorUpgrade != true && platformName != 'linux' && ((currentDate|date - profileAgeCreated) / 604800000) >= 5 && !activeNotifications && 'browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features'|preferenceValue && ((currentDate|date - profileAgeCreated) / 604800000) < 15"
- id: CFR_FULL_VIDEO_SUPPORT_EN
  groups:
    - cfr
  targeting:
    firefoxVersion < 88 && firefoxVersion != 78 && localeLanguageCode in ['en', 'fr', 'de', 'ru', 'zh', 'es', 'it', 'pl']
  template: cfr_doorhanger
  content:
    skip_address_bar_notifier: true
    persistent_doorhanger: true
    anchor_id: PanelUI-menu-button
    layout: icon_and_message
    text:
      string_id: cfr-doorhanger-video-support-body
    buttons:
      secondary:
        - label:
            string_id: cfr-doorhanger-extension-cancel-button
          action:
            type: CANCEL
      primary:
        label:
          string_id: cfr-doorhanger-video-support-primary-button
        action:
          type: OPEN_URL
          data:
            args: https://support.mozilla.org/kb/update-firefox-latest-release
            where: tabshifted
    bucket_id: CFR_FULL_VIDEO_SUPPORT_EN
    heading_text:
      string_id: cfr-doorhanger-video-support-header
    info_icon:
      label:
        string_id: cfr-doorhanger-extension-sumo-link
      sumo_path: extensionrecommendations
    notification_text: Message from Firefox
    category: cfrFeatures
  frequency:
    lifetime: 3
  trigger:
    id: openURL
    patterns:
      - https://*/Amazon-Video/*
      - https://*/Prime-Video/*
    params:
      - www.hulu.com
      - hulu.com
      - www.netflix.com
      - netflix.com
      - www.disneyplus.com
      - disneyplus.com
      - www.hbomax.com
      - hbomax.com
      - www.sho.com
      - sho.com
      - www.directv.com
      - directv.com
      - www.starzplay.com
      - starzplay.com
      - www.sling.com
      - sling.com
      - www.facebook.com
      - facebook.com
- id: better-internet-c-rollout-cfr
  groups:
    - eco
  content:
    template: logo-and-content
    logoImageURL: https://www.mozilla.org/media/img/firefox/onboarding/mountain.bd39012cc5a9.svg
    logo:
      imageURL: https://www.mozilla.org/media/img/firefox/onboarding/mountain.bd39012cc5a9.svg
      size: 115px
    body:
      title:
        label: A better internet starts with you
        size: 24px
      text:
        label: When you use Firefox, you’re voting for an open and accessible internet that’s better for everyone.
        size: 16px
      primary:
        label: Pin to taskbar
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label: Not now
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky and study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Additional message non-overlap
  targeting: >-
    userMonthlyActivity|length >= 1 &&
    userMonthlyActivity|length <= 6 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release' &&
    version|versionCompare('94.!') >= 0 &&
    locale in ['en-CA', 'en-GB', 'en-US']
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    (messageImpressions|keys intersect [
    'better-internet-c-rollout:rollout-30',
    'better-internet-infrequent-eco2202:control',
    'better-internet-infrequent-eco2202:treatment-a',
    'better-internet-infrequent-eco2202:treatment-b',
    'better-internet-infrequent-modal:treatment-a',
    'better-internet-infrequent-modal:treatment-b',
    'better-internet-infrequent-modal:treatment-c',
    'download-mobile-regular-modal:treatment-a',
    'download-mobile-regular-modal:treatment-b',
    'download-mobile-regular-modal:treatment-c',
    'peace-of-mind-a-rollout:rollout-30',
    'peace-of-mind-casual-modal:treatment-a',
    'peace-of-mind-casual-modal:treatment-b',
    'peace-of-mind-casual-modal:treatment-c'
    ])|length == 0
- id: peace-of-mind-a-rollout-cfr
  groups:
    - eco
  content:
    template: logo-and-content
    logoImageURL: https://www.mozilla.org/media/img/firefox/onboarding/umbrella.041dbea876c4.png
    logo:
      imageURL: https://www.mozilla.org/media/img/firefox/onboarding/umbrella.041dbea876c4.png
      size: 115px
    body:
      title:
        label: We’ve got you covered
        size: 24px
      text:
        label: Every month, Firefox blocks an average of over 3,000 trackers per user. Because nothing, especially privacy nuisances like trackers, should stand between you and the good internet.
        size: 16px
      primary:
        label: Pin to taskbar
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label: Not now
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky and study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Additional message non-overlap
  targeting: >-
    userMonthlyActivity|length >= 7 &&
    userMonthlyActivity|length <= 13 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release' &&
    version|versionCompare('94.!') >= 0 &&
    locale in ['en-CA', 'en-GB', 'en-US']
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    (messageImpressions|keys intersect [
    'better-internet-c-rollout:rollout-30',
    'better-internet-infrequent-eco2202:control',
    'better-internet-infrequent-eco2202:treatment-a',
    'better-internet-infrequent-eco2202:treatment-b',
    'better-internet-infrequent-modal:treatment-a',
    'better-internet-infrequent-modal:treatment-b',
    'better-internet-infrequent-modal:treatment-c',
    'download-mobile-regular-modal:treatment-a',
    'download-mobile-regular-modal:treatment-b',
    'download-mobile-regular-modal:treatment-c',
    'peace-of-mind-a-rollout:rollout-30',
    'peace-of-mind-casual-modal:treatment-a',
    'peace-of-mind-casual-modal:treatment-b',
    'peace-of-mind-casual-modal:treatment-c'
    ])|length == 0
- id: better-internet-c-rollout-fast
  groups:
    - eco
  content:
    template: logo-and-content
    logoImageURL: https://www.mozilla.org/media/img/firefox/onboarding/mountain.bd39012cc5a9.svg
    logo:
      imageURL: https://www.mozilla.org/media/img/firefox/onboarding/mountain.bd39012cc5a9.svg
      size: 115px
    body:
      title:
        label:
          string_id: spotlight-better-internet-header
        size: 24px
      text:
        label:
          string_id: spotlight-better-internet-body
        size: 16px
      primary:
        label:
          string_id: spotlight-pin-primary-button
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label:
          string_id: spotlight-pin-secondary-button
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky, study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Custom version and locale targeting for RemoteL10n
  targeting: >-
    userMonthlyActivity|length >= 1 &&
    userMonthlyActivity|length <= 6 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release'
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    version|versionCompare('95.!') >= 0 &&
    !(version in ['96.0', '96.0.1']) &&
    locale in ['zh-CN', 'de', 'fr', 'es-ES', 'ru', 'pt-BR', 'it', 'es-MX', 'ja']
- id: peace-of-mind-a-rollout-fast
  groups:
    - eco
  content:
    template: logo-and-content
    logoImageURL: https://www.mozilla.org/media/img/firefox/onboarding/umbrella.041dbea876c4.png
    logo:
      imageURL: https://www.mozilla.org/media/img/firefox/onboarding/umbrella.041dbea876c4.png
      size: 115px
    body:
      title:
        label:
          string_id: spotlight-peace-mind-header
        size: 24px
      text:
        label:
          string_id: spotlight-peace-mind-body
        size: 16px
      primary:
        label:
          string_id: spotlight-pin-primary-button
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label:
          string_id: spotlight-pin-secondary-button
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky, study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Custom version and locale targeting for RemoteL10n
  targeting: >-
    userMonthlyActivity|length >= 7 &&
    userMonthlyActivity|length <= 13 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release'
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    version|versionCompare('95.!') >= 0 &&
    !(version in ['96.0', '96.0.1']) &&
    locale in ['zh-CN', 'de', 'fr', 'es-ES', 'ru', 'pt-BR', 'it', 'es-MX', 'ja']
