- id: MILESTONE_MESSAGE
  groups:
    - cfr
  content:
    anchor_id: tracking-protection-icon-box
    bucket_id: CFR_MILESTONE_MESSAGE
    buttons:
      primary:
        action:
          type: OPEN_PROTECTION_REPORT
        event: PROTECTION
        label:
          string_id: cfr-doorhanger-milestone-ok-button
      secondary:
        - label:
            string_id: "cfr-doorhanger-milestone-close-button"
          action:
            type: "CANCEL"
          event: "DISMISS"
    category: cfrFeatures
    heading_text:
      string_id: cfr-doorhanger-milestone-heading
    layout: short_message
    notification_text: ''
    skip_address_bar_notifier: true
    text: ''
  frequency:
    lifetime: 7
  targeting: pageLoad >= 4 && firefoxVersion < 87 && userPrefs.cfrFeatures
  template: milestone_message
  trigger:
    id: contentBlocking
    params:
      - ContentBlockingMilestone
- id: MILESTONE_MESSAGE_87
  groups:
    - cfr
  content:
    anchor_id: tracking-protection-icon-box
    bucket_id: CFR_MILESTONE_MESSAGE
    buttons:
      primary:
        action:
          type: OPEN_PROTECTION_REPORT
        event: PROTECTION
        label:
          string_id: cfr-doorhanger-milestone-ok-button
      secondary:
        - label:
            string_id: "cfr-doorhanger-milestone-close-button"
          action:
            type: "CANCEL"
          event: "DISMISS"
    category: cfrFeatures
    heading_text:
      string_id: cfr-doorhanger-milestone-heading2
    layout: short_message
    notification_text: ''
    skip_address_bar_notifier: true
    text: ''
  frequency:
    lifetime: 7
  targeting: pageLoad >= 4 && firefoxVersion >= 87 && userPrefs.cfrFeatures
  template: milestone_message
  trigger:
    id: contentBlocking
    params:
      - ContentBlockingMilestone
- id: DOH_ROLLOUT_CONFIRMATION_89
  groups:
    - cfr
  targeting: >-
    (
    'doh-rollout.enabled'|preferenceValue ||
    'doh-rollout.self-enabled'|preferenceValue ||
    'doh-rollout.ru.enabled'|preferenceValue ||
    'doh-rollout.ua.enabled'|preferenceValue
    ) &&
    !(
    'doh-rollout.disable-heuristics'|preferenceValue ||
    'doh-rollout.skipHeuristicsCheck'|preferenceValue ||
    'doh-rollout.doorhanger-decision'|preferenceValue
    ) &&
    firefoxVersion >= 89
  template: infobar
  content:
    priority: 3
    type: global
    text:
      string_id: cfr-doorhanger-doh-body
    buttons:
      - label:
          string_id: cfr-doorhanger-doh-primary-button-2
        action:
          type: ACCEPT_DOH
        primary: true
      - label:
          string_id: cfr-doorhanger-doh-secondary-button
        action:
          type: DISABLE_DOH
      - label:
          string_id: notification-learnmore-default-label
        supportPage: dns-over-https
        # Use no callback/action so telemetry doesn't mix link and secondary
        callback: null
        action:
          type: CANCEL
    bucket_id: DOH_ROLLOUT_CONFIRMATION_89
    category: cfrFeatures
  frequency:
    lifetime: 3
  trigger:
    id: openURL
    patterns:
      - "*://*/*"
- id: INFOBAR_DEFAULT_AND_PIN_87
  groups:
    - cfr
  content:
    category: cfrFeatures
    bucket_id: INFOBAR_DEFAULT_AND_PIN_87
    text:
      string_id: default-browser-notification-message
    type: global
    buttons:
      - label:
          string_id: default-browser-notification-button
        action:
          type: PIN_AND_DEFAULT
        primary: true
        accessKey: P
  trigger:
    id: defaultBrowserCheck
  template: infobar
  frequency:
    lifetime: 2
    custom:
      - period: 3024000000  # 86400000 * 35 (35 days to ms)
        cap: 1
  # Not default browser and user dismissed the default browser prompt
  # For Firefox version 87-88 the message is triggered only on the newtab page.
  # For versions 89+ we trigger the message at startup and want to ignore the
  # newtab trigger.
  targeting:
    "((firefoxVersion >= 87 && firefoxVersion < 89) || (firefoxVersion >= 89 && source == 'startup')) && !isDefaultBrowser && !'browser.shell.checkDefaultBrowser'|preferenceValue && isMajorUpgrade != true && platformName != 'linux' && ((currentDate|date - profileAgeCreated) / 604800000) >= 5 && !activeNotifications && 'browser.newtabpage.activity-stream.asrouter.userprefs.cfr.features'|preferenceValue && ((currentDate|date - profileAgeCreated) / 604800000) < 15"
- id: CFR_FULL_VIDEO_SUPPORT_EN
  groups:
    - cfr
  targeting:
    firefoxVersion < 88 && firefoxVersion != 78 && localeLanguageCode in ['en', 'fr', 'de', 'ru', 'zh', 'es', 'it', 'pl']
  template: cfr_doorhanger
  content:
    skip_address_bar_notifier: true
    persistent_doorhanger: true
    anchor_id: PanelUI-menu-button
    layout: icon_and_message
    text:
      string_id: cfr-doorhanger-video-support-body
    buttons:
      secondary:
        - label:
            string_id: cfr-doorhanger-extension-cancel-button
          action:
            type: CANCEL
      primary:
        label:
          string_id: cfr-doorhanger-video-support-primary-button
        action:
          type: OPEN_URL
          data:
            args: https://support.mozilla.org/kb/update-firefox-latest-release
            where: tabshifted
    bucket_id: CFR_FULL_VIDEO_SUPPORT_EN
    heading_text:
      string_id: cfr-doorhanger-video-support-header
    info_icon:
      label:
        string_id: cfr-doorhanger-extension-sumo-link
      sumo_path: extensionrecommendations
    notification_text: Message from Firefox
    category: cfrFeatures
  frequency:
    lifetime: 3
  trigger:
    id: openURL
    patterns:
      - https://*/Amazon-Video/*
      - https://*/Prime-Video/*
    params:
      - www.hulu.com
      - hulu.com
      - www.netflix.com
      - netflix.com
      - www.disneyplus.com
      - disneyplus.com
      - www.hbomax.com
      - hbomax.com
      - www.sho.com
      - sho.com
      - www.directv.com
      - directv.com
      - www.starzplay.com
      - starzplay.com
      - www.sling.com
      - sling.com
      - www.facebook.com
      - facebook.com
- id: better-internet-c-rollout-global
  groups:
    - eco
  content:
    template: logo-and-content
    logo:
      imageURL: chrome://activity-stream/content/data/content/assets/remote/mountain.svg
      size: 115px
    body:
      title:
        label:
          string_id: spotlight-better-internet-header
        size: 20px
      text:
        label:
          string_id: spotlight-better-internet-body
        size: 16px
      primary:
        label:
          string_id: spotlight-pin-primary-button
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label:
          string_id: spotlight-pin-secondary-button
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky, study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Custom version targeting for localized strings
  targeting: >-
    userMonthlyActivity|length >= 1 &&
    userMonthlyActivity|length <= 6 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release'
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    version|versionCompare('99.!') >= 0
- id: peace-of-mind-a-rollout-global
  groups:
    - eco
  content:
    template: logo-and-content
    logo:
      imageURL: chrome://activity-stream/content/data/content/assets/remote/umbrella.png
      size: 115px
    body:
      title:
        label:
          string_id: spotlight-peace-mind-header
        size: 20px
      text:
        label:
          string_id: spotlight-peace-mind-body
        size: 15px
      primary:
        label:
          string_id: spotlight-pin-primary-button
        action:
          type: PIN_FIREFOX_TO_TASKBAR
      secondary:
        label:
          string_id: spotlight-pin-secondary-button
        action:
          type: CANCEL
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 1
  # 1. Nimbus rollout enrollment targeting except sticky, study opt-out
  # 2. Nimbus rollout message targeting except user prefs (handled by groups)
  # 3. Custom version targeting for localized strings
  targeting: >-
    userMonthlyActivity|length >= 7 &&
    userMonthlyActivity|length <= 13 &&
    (currentDate|date - profileAgeCreated|date) / 86400000 >= 28 &&
    doesAppNeedPin  &&
    browserSettings.update.channel == 'release'
    &&
    source == 'startup' &&
    !isMajorUpgrade &&
    !activeNotifications
    &&
    version|versionCompare('99.!') >= 0
- id: tcp-spotlight-opt-in-rollout
  groups:
    - tcp
  content:
    template: logo-and-content
    logo:
      imageURL: chrome://branding/content/about-logo@2x.png
      size: 64px
    body:
      title:
        label:
          string_id: spotlight-total-cookie-protection-header
        size: 23px
      text:
        label:
          string_id: spotlight-total-cookie-protection-body
        size: 18px
      primary:
        label:
          string_id: spotlight-total-cookie-protection-primary-button
        action:
          type: ENABLE_TOTAL_COOKIE_PROTECTION
      secondary:
        label:
          string_id: spotlight-total-cookie-protection-secondary-button
        action:
          type: ENABLE_TOTAL_COOKIE_PROTECTION_SECTION_AND_OPT_OUT
    extra:
      expanded:
        label:
          string_id: spotlight-total-cookie-protection-expanded
        size: 13px
  priority: 1
  trigger:
    id: defaultBrowserCheck
  template: spotlight
  frequency:
    lifetime: 2
    custom:
      - period: 691200000  # 1000 * 60 * 60 * 24 * 8 (8 days in ms)
        cap: 1
  # 1. Basic "study" message release/beta/aurora Fx100.0.1+ targeting
  # 2. Custom TCP opt-in, e.g., default cookie behavior, not interacted, not experiment
  # 3. Not new profiles at least 3 hours old in ms (1000 * 60 * 60 * 3)
  targeting: >-
    source == 'startup' &&
    !isMajorUpgrade &&
    'app.shield.optoutstudies.enabled'|preferenceValue &&
    browserSettings.update.channel in ['release', 'beta', 'aurora'] &&
    version|versionCompare('100.0.1') >= 0
    &&
    'network.cookie.cookieBehavior'|preferenceValue == 4 &&
    !'privacy.restrict3rdpartystorage.rollout.enabledByDefault'|preferenceIsUserSet &&
    !'browser.privatebrowsing.autostart'|preferenceValue &&
    !'browser.search.param.google_channel_us'|preferenceValue('')|regExpMatch('^[ntc]us5$') &&
    !'browser.search.param.google_channel_row'|preferenceValue('')|regExpMatch('^[ntc]row5$')
    &&
    currentDate|date - profileAgeCreated >= 10800000
