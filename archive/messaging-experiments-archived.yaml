- id: MULTISTAGE_ABOUT_WELCOME_TEST
  enabled: true
  filter_expression: env.version >= '78.' && env.version < '80.'
  targeting: localeLanguageCode == "en" &&
    firefoxVersion >= 78 &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'multistage_aboutwelcome_test' in activeExperiments)
  arguments:
    slug: multistage_aboutwelcome_test
    userFacingName: "About:Welcome MultiStage Welcome Test"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/
    userFacingDescription: Test study to validate launching multistage welcome flow via experiment framework.
    isEnrollmentPaused: false
    branches:
      - slug: multistage_aboutwelcome_test_control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: multistage_aboutwelcome_test_treatment
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
- id: AW_PULL_FACTOR_PRIVACY_1
  enabled: true
  filter_expression: ('76' in env.version) || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_1"]|bucketSample(0,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_1' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_1
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW

- id: AW_PULL_FACTOR_PRIVACY_2
  enabled: true
  filter_expression: ('76' in env.version) || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_2"]|bucketSample(0,
    2000, 10000) &&
    !(((currentDate|date - profileAgeCreated) / 86400000) > 1) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_2' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_2
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
- id: AW_PULL_FACTOR_PRIVACY_3
  enabled: true
  filter_expression: ('76' in env.version && env.channel == 'beta' &&
    !(env.telemetry.main.environment.profile.creationDate < ('2020-04-28'|date / 1000 / 60 / 60 / 24)))
    || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_3"]|bucketSample(0,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_3' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_3
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
- id: CFR_XMAN_SMOKE_TEST
  enabled: true
  targeting: localeLanguageCode == 'en' &&
    firefoxVersion >= 77 && [userId, 'cfr_xman_smoke_test']|bucketSample(0, 2000, 10000)
  filter_expression: env.channel == 'nightly'
  arguments:
    slug: cfr_xman_smoke_test
    userFacingName: CFR X-Man smoke test
    userFacingDescription: Test X-Man ability to deploy CFR experiments
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - cfr
        value:
          id: FACEBOOK_CONTAINER_3_72
          content:
            addon:
              amo_url: https://addons.mozilla.org/firefox/addon/facebook-container/
              author: Mozilla
              icon: resource://activity-stream/data/content/assets/cfr_fb_container.png
              id: '954390'
              rating: 4.5
              title: Facebook Container
              users: 1455872
            bucket_id: CFR_M1
            buttons:
              primary:
                action:
                  data:
                    url: null
                  type: INSTALL_ADDON_FROM_URL
                label:
                  string_id: cfr-doorhanger-extension-ok-button
                secondary:
                  - action:
                      type: CANCEL
                    label:
                      string_id: cfr-doorhanger-extension-cancel-button
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - action:
                      data:
                        category: general-cfraddons
                        origin: CFR
                      type: OPEN_PREFERENCES_PAGE
                    label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrAddons
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            text: Stop Facebook from tracking your activity across the web. Use Facebook the
              way you normally do without annoying ads following you around.
          frequency:
            lifetime: 3
          targeting: localeLanguageCode == 'en' &&  (xpinstallEnabled == true) &&
            (['@contain-facebook','{bb1b80be-e6b3-40a1-9b6e-9d4073343f0b}',
            '{a50d61ca-d27b-437a-8b52-5fd801a0a88b}'] intersect addonsInfo.addons|keys)|length == 0 &&
            (['www.facebook.com','facebook.com','messenger.com','www.messenger.com',
            'instagram.com','www.instagram.com','whatsapp.com','www.whatsapp.com','web.whatsapp.com']
            intersect topFrecentSites[.frecency >= 5000]|mapToProperty('host'))|length > 0 && userPrefs.cfrAddons
          priority: 5
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - www.facebook.com
              - facebook.com
              - www.instagram.com
              - instagram.com
              - www.whatsapp.com
              - whatsapp.com
              - web.whatsapp.com
              - www.messenger.com
              - messenger.com
      - slug: variant_1
        ratio: 1
        groups:
          - cfr
        value:
          id: FACEBOOK_CONTAINER_3_72
          content:
            addon:
              amo_url: https://addons.mozilla.org/firefox/addon/facebook-container/
              author: Mozilla
              icon: resource://activity-stream/data/content/assets/cfr_fb_container.png
              id: '954390'
              rating: 4.5
              title: Facebook Container
              users: 1455872
            bucket_id: CFR_M1
            buttons:
              primary:
                action:
                  data:
                    url: null
                  type: INSTALL_ADDON_FROM_URL
                label:
                  string_id: cfr-doorhanger-extension-ok-button
                secondary:
                  - action:
                      type: CANCEL
                    label:
                      string_id: cfr-doorhanger-extension-cancel-button
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - action:
                      data:
                        category: general-cfraddons
                        origin: CFR
                      type: OPEN_PREFERENCES_PAGE
                    label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrAddons
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            text: Stop Facebook from tracking your activity across the web. Use Facebook the
              way you normally do without annoying ads following you around.
          frequency:
            lifetime: 3
          targeting: localeLanguageCode == 'en' &&  (xpinstallEnabled == true) &&
            (['@contain-facebook','{bb1b80be-e6b3-40a1-9b6e-9d4073343f0b}',
            '{a50d61ca-d27b-437a-8b52-5fd801a0a88b}'] intersect addonsInfo.addons|keys)|length == 0 &&
            (['www.facebook.com','facebook.com','messenger.com','www.messenger.com',
            'instagram.com','www.instagram.com','whatsapp.com','www.whatsapp.com','web.whatsapp.com']
            intersect topFrecentSites[.frecency >= 5000]|mapToProperty('host'))|length > 0 && userPrefs.cfrAddons
          priority: 5
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - www.facebook.com
              - facebook.com
              - www.instagram.com
              - instagram.com
              - www.whatsapp.com
              - whatsapp.com
              - web.whatsapp.com
              - www.messenger.com
              - messenger.com
- id: RECOMMEND_PICTURE_IN_PICTURE_CFR
  enabled: true
  arguments:
    slug: bug-1635199-message-recommend-picture-in-picture-cfr-beta-77-77
    branches:
      - slug: n4s_pip_control
        ratio: 50
        value: {}
        groups:
          - cfr
      - slug: n4s_pip_cfr
        ratio: 50
        groups:
          - cfr
        value:
          id: N4S_PIP_CFR_MESSSAGE
          content:
            bucket_id: N4S_PIP_CFR_MESSSAGE
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    string_id: cfr-doorhanger-extension-cancel-button
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Multitask with Picture-in-Picture
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Pop video into a floating window to keep watching while you work in other tabs. Hover over any video and select the small blue rectangle that appears.
          frequency:
            lifetime: 3
          targeting: 'true'
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - youtube.com
              - netflix.com
              - vimeo.com
              - twitch.tv
              - dailymotion.com
              - hulu.com
              - ustream.com
              - metacafe.com
              - disneyplus.com
              - www.youtube.com
              - www.netflix.com
              - www.vimeo.com
              - www.twitch.tv
              - www.dailymotion.com
              - www.hulu.com
              - www.ustream.com
              - www.metacafe.com
              - www.disneyplus.com
    isHighVolume: false
    userFacingName: Recommend Picture-in-Picture CFR
    isEnrollmentPaused: true
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/recommend-picture-in-picture-cfr/
    userFacingDescription: If we introduce PiP via CFR for users visiting video sites frequently, then we will see more adoption of the PiP feature because we have observed the feature is not easily discovered via user research observations.
  filter_expression: env.version >= '77.' && env.version < '78.'
  targeting: |
    locale == 'en-US' && userPrefs.cfrFeatures && firefoxVersion == 77 &&
    browserSettings.update.channel == 'beta' &&
    'media.videocontrols.picture-in-picture.video-toggle.enabled'|preferenceValue &&
    [userId, 'n4s-workweek']|bucketSample(0, 500, 10000)
- id: PRIVACY-PROTECTIONS-REPORT-ONBOARDING-N4S
  enabled: true
  filter_expression: env.version >= '77.' && env.version < '78.' && env.channel == 'beta' &&
    !(env.telemetry.main.environment.profile.creationDate < ('2020-05-06'|date / 1000 / 60 / 60 / 24))
  targeting: locale == 'en-US' && [userId, "n4s-workweek"]|bucketSample(2500,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'bug-1635870-message-privacy-protections-report-onboarding-n4s-beta-76-77' in activeExperiments)
  arguments:
    slug: bug-1635870-message-privacy-protections-report-onboarding-n4s-beta-76-77
    userFacingName: "Privacy Protections Report Onboarding (N4S)"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/privacy-protections-report-onboarding-n4s/
    userFacingDescription: This experiment will compare a treatment branch with the default onboarding experience, to a set of treatments with a new protection report card.
    isEnrollmentPaused: true
    branches:
      - slug: n4s_protections_report_control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: n4s_protections_report_position1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: n4s_protections_report_position2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: "https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead"
                      where: tabshifted
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
      - slug: n4s_protections_report_position3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: "https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead"
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
- id: MULTI-STAGE-ABOUTWELCOME-V1-78-BETA-V2
  enabled: true
  filter_expression: env.version >= '78.' && env.version < '79.' && env.channel == 'beta' && env.appinfo.appBuildID >= '20200611192304'
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: localeLanguageCode == "en" && [userId, "bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79"]|bucketSample(0, 5000, 10000) &&
    ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79' in activeExperiments)
  arguments:
    slug: bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79
    userFacingName: "About:Welcome MultiStage Welcome Beta"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/multi-stage-aboutwelcome-v1-78-beta-v2/
    userFacingDescription: Study to validate launching multistage welcome flow via experiment framework.
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: treatment-static
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
      - slug: treatment-dynamic
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-importable
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
- id: MULTI-STAGE-ABOUTWELCOME-V1-78-RELEASE
  enabled: true
  filter_expression: env.version >= '78.' && env.version < '79.' && env.channel == 'release'
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: localeLanguageCode == "en" && [userId, "bug-1644257-message-multi-stage-aboutwelcome-v1-78-release-release-78-79"]|bucketSample(0, 2000, 10000) &&
    ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1644257-message-multi-stage-aboutwelcome-v1-78-release-release-78-79' in activeExperiments)
  arguments:
    slug: bug-1644257-message-multi-stage-aboutwelcome-v1-78-release-release-78-79
    userFacingName: "Multi-Stage About:Welcome V1 78 Release"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/multi-stage-aboutwelcome-v1-78-release/
    userFacingDescription: Study to validate Multi-stage onboarding experience.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: treatment-static
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
      - slug: treatment-dynamic
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-importable
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
- id: "ABOUTWELCOME-PULL-FACTOR-REINFORCEMENT-76-RELEASE"
  enabled: true
  filter_expression: (env.version >= '76.' && env.version < '77.' && env.channel == 'release' &&
    !(env.telemetry.main.environment.profile.creationDate < ('2020-05-13'|date / 1000 / 60 / 60 / 24))) ||
    (locale == 'en-US' && [userId, "aboutwelcome-pull-factor-reinforcement-76-release"]|bucketSample(0,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'bug-1637316-message-aboutwelcome-pull-factor-reinforcement-76-rel-release-76-77' in activeExperiments))
  arguments:
    slug: bug-1637316-message-aboutwelcome-pull-factor-reinforcement-76-rel-release-76-77
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement-76-release/
    userFacingDescription: 4 branch experiment different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention. Test deployment of multiple branches using new experiment framework
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: treatment-variation-b
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: treatment-variation-c
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: treatment-variation-d
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
- id: "PROTECTION-RETENTION-EXPERIMENT-RELEASE-BUG-1645918"
  enabled: true
  filter_expression: (env.channel == 'release' || env.channel == 'default') && env.version >= '77.'
  targeting: localeLanguageCode == 'en' && [userId, "messaging-experiments-cfr"]|bucketSample(0, 310, 10000) && 'app.shield.optoutstudies.enabled'|preferenceValue
  arguments:
    slug: bug-1646798-message-high-velocity-message-testing-privacy-retenti-release-77-79
    userFacingName: Message Router Content Experiment High Velocity Message Testing Privacy Retention Study
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/high-velocity-message-testing-privacy-retention-study/
    userFacingDescription: If users are messaged to visit the about:protections page then they will understand the value Fx is providing them and be more likely to retain longer term
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - cfr
        value: {}
      - slug: treatment-variation-a
        ratio: 1
        groups:
          - cfr
        value:
          id: PROTECTIONS_RETENTION_PRIVACY
          template: cfr_doorhanger
          groups: [cfr]
          content:
            layout: icon_and_message
            category: cfrFeatures
            anchor_id: tracking-protection-icon-box
            skip_address_bar_notifier: true
            bucket_id: PROTECTIONS_RETENTION_PRIVACY
            heading_text: Putting your privacy before profits
            notification_text: ''
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            text: You’re using the only major browser backed by a non-profit. See how Firefox puts your privacy first.
            icon: chrome://browser/content/logos/tracking-protection.svg
            icon_dark_theme: chrome://browser/content/logos/tracking-protection-dark-theme.svg
            buttons:
              primary:
                label:
                  value: Show Me
                  attributes:
                    accesskey: S
                action:
                  type: OPEN_URL
                  data:
                    args: https://www.mozilla.org/firefox/privacy/?utm_source=firefox-desktop&utm_campaign=hvt-privacy-retention&utm_medium=referral
                    where: tab
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
          targeting: recentVisits|length > 1
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          trigger:
            id: frequentVisits
            patterns:
              - http://*/*
              - https://*/*
      - slug: treatment-variation-b
        ratio: 1
        groups:
          - cfr
        value:
          id: PROTECTIONS_RETENTION_PROTECTIONS
          template: cfr_doorhanger
          groups: [cfr]
          content:
            layout: icon_and_message
            category: cfrFeatures
            anchor_id: tracking-protection-icon-box
            skip_address_bar_notifier: true
            bucket_id: PROTECTIONS_RETENTION_PROTECTIONS
            heading_text: Putting your privacy before profits
            notification_text: ''
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            text: You’re using the only major browser backed by a non-profit. See how Firefox puts your privacy first.
            icon: chrome://browser/content/logos/tracking-protection.svg
            icon_dark_theme: chrome://browser/content/logos/tracking-protection-dark-theme.svg
            buttons:
              primary:
                label:
                  value: Show Me
                  attributes:
                    accesskey: S
                action:
                  type: OPEN_PROTECTION_REPORT
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: recentVisits|length > 1
          trigger:
            id: frequentVisits
            patterns:
              - http://*/*
              - https://*/*
      - slug: treatment-variation-c
        ratio: 1
        groups:
          - cfr
        value:
          id: PROTECTIONS_RETENTION_MONITOR
          template: cfr_doorhanger
          groups: [cfr]
          content:
            layout: icon_and_message
            category: cfrFeatures
            anchor_id: tracking-protection-icon-box
            skip_address_bar_notifier: true
            bucket_id: PROTECTIONS_RETENTION_MONITOR
            heading_text: Putting your privacy before profits
            notification_text: ''
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            text: You’re using the only major browser backed by a non-profit. See how Firefox puts your privacy first.
            icon: chrome://browser/content/logos/tracking-protection.svg
            icon_dark_theme: chrome://browser/content/logos/tracking-protection-dark-theme.svg
            buttons:
              primary:
                label:
                  value: Show Me
                  attributes:
                    accesskey: S
                action:
                  type: OPEN_URL
                  data:
                    args: https://monitor.firefox.com/?utm_source=firefox-desktop&utm_campaign=hvt-privacy-retention&utm_medium=referral
                    where: tab
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: recentVisits|length > 1
          trigger:
            id: frequentVisits
            patterns:
              - http://*/*
              - https://*/*
- id: "MESSAGE-ROUTER-CONTENT-EXPERIMENT-RELEASE-BUG-1651993"
  enabled: true
  filter_expression: env.version >= '77.'
  targeting: localeLanguageCode == 'en' &&
    'app.shield.optoutstudies.enabled'|preferenceValue &&
    [userId, "messaging-experiments-cfr"]|bucketSample(0, 153, 10000)
  arguments:
    slug: bug-1651993-high-velocity-message-testing-multi-account-containers-retention-study
    userFacingName: Message Router Content Experiment High Velocity Message Testing Multi-Account Containers Retention Study
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/high-velocity-message-testing-multi-account-containers-retention-study/
    userFacingDescription: This promotes Multi-Account Containers Addon via CFR to users and investigates if the addon has a positive effect in terms of Firefox retention. We will use a conditional trigger here to show the CFR to users at the most relevant moment. We believe this can drive the addon adoption which will improve retention.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - cfr
        value: {}
      - slug: treatmeant-a
        ratio: 1
        groups:
          - cfr
        value:
          id: EXPERIMENT_SHOPPING_TO_SOCIAL
          template: cfr_doorhanger
          groups:
            - cfr
          content:
            layout: addon_recommendation
            category: cfrAddons
            bucket_id: EXPERIMENT_SHOPPING_TO_SOCIAL
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            addon:
              id: "782160"
              title: Firefox Multi-Account Containers
              icon_dark_theme: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0Y5RjlGQSIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              icon: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzBDMEMwRCIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              rating: 4.6
              users: 226263
              author: Mozilla Firefox
              amo_url: https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/
            text: Are the ads you’re seeing suspiciously related to your recent online shopping? Use Firefox containers to make it harder for sites like these to track you.
            buttons:
              primary:
                label:
                  value: I’m in!
                  attributes:
                    accesskey: I
                action:
                  type: INSTALL_ADDON_FROM_URL
                  data:
                    url: null
                    telemetrySource: amo
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
                  action:
                    type: OPEN_PREFERENCES_PAGE
                    data:
                      category: general-cfraddons
          frequency:
            lifetime: 3
          targeting: (addonsInfo.addons|keys intersect ["@testpilot-containers"])|length == 0 && ((currentDate|date - profileAgeCreated) / 604800000) >= 1 && (topFrecentSites[.frecency > 100]|mapToProperty("host") intersect ["amazon.com","ebay.com","zillow.com","discord.com","craigslist.org","walmart.com","homedepot.com","etsy.com","target.com","roblox.com","wayfair.com","lowes.com","overstock.com","zappos.com","wish.com","sears.com","kohls.com","costco.com","everlane.com","www.amazon.com","www.ebay.com","www.zillow.com","www.discord.com","www.craigslist.org","www.walmart.com","www.homedepot.com","www.etsy.com","www.target.com","www.roblox.com","www.wayfair.com","www.lowes.com","www.overstock.com","www.zappos.com","www.wish.com","www.sears.com","www.kohls.com","www.costco.com","www.everlane.com"])|length && userPrefs.cfrAddons
          trigger:
            id: openURL
            params:
              - www.youtube.com
              - www.facebook.com
              - www.twitter.com
              - www.instagram.com
              - www.reddit.com
              - www.pinterest.com
              - www.linkedin.com
              - www.whatsapp.com
              - www.tiktok.com
              - www.messenger.com
              - www.tumblr.com
              - www.groupme.com
              - www.flickr.com
              - youtube.com
              - facebook.com
              - twitter.com
              - instagram.com
              - reddit.com
              - pinterest.com
              - linkedin.com
              - whatsapp.com
              - tiktok.com
              - messenger.com
              - tumblr.com
              - groupme.com
              - flickr.com
      - slug: treatmeant-b
        ratio: 1
        groups:
          - cfr
        value:
          id: EXPERIMENT_SOCIAL_TO_SHOPPING
          template: cfr_doorhanger
          groups:
            - cfr
          content:
            layout: addon_recommendation
            category: cfrAddons
            bucket_id: EXPERIMENT_SOCIAL_TO_SHOPPING
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            addon:
              id: "782160"
              title: Firefox Multi-Account Containers
              icon_dark_theme: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0Y5RjlGQSIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              icon: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzBDMEMwRCIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              rating: 4.6
              users: 226263
              author: Mozilla Firefox
              amo_url: https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/
            text: You can make it harder for social media sites to track your online shopping with Firefox containers.
            buttons:
              primary:
                label:
                  value: Add the Extension
                  attributes:
                    accesskey: A
                action:
                  type: INSTALL_ADDON_FROM_URL
                  data:
                    url: null
                    telemetrySource: amo
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
                  action:
                    type: OPEN_PREFERENCES_PAGE
                    data:
                      category: general-cfraddons
          frequency:
            lifetime: 3
          targeting: (addonsInfo.addons|keys intersect ["@testpilot-containers"])|length == 0 && ((currentDate|date - profileAgeCreated) / 604800000) >= 1 && (topFrecentSites[.frecency > 100]|mapToProperty("host") intersect ["www.youtube.com","www.facebook.com","www.twitter.com","www.instagram.com","www.reddit.com","www.pinterest.com","www.linkedin.com","www.whatsapp.com","www.tiktok.com","www.messenger.com","www.tumblr.com","www.groupme.com","www.flickr.com","youtube.com","facebook.com","twitter.com","instagram.com","reddit.com","pinterest.com","linkedin.com","whatsapp.com","tiktok.com","messenger.com","tumblr.com","groupme.com","flickr.com"])|length && userPrefs.cfrAddons
          trigger:
            id: openURL
            params:
              - amazon.com
              - ebay.com
              - zillow.com
              - discord.com
              - craigslist.org
              - walmart.com
              - homedepot.com
              - etsy.com
              - target.com
              - roblox.com
              - wayfair.com
              - lowes.com
              - overstock.com
              - zappos.com
              - wish.com
              - sears.com
              - kohls.com
              - costco.com
              - everlane.com
              - www.amazon.com
              - www.ebay.com
              - www.zillow.com
              - www.discord.com
              - www.craigslist.org
              - www.walmart.com
              - www.homedepot.com
              - www.etsy.com
              - www.target.com
              - www.roblox.com
              - www.wayfair.com
              - www.lowes.com
              - www.overstock.com
              - www.zappos.com
              - www.wish.com
              - www.sears.com
              - www.kohls.com
              - www.costco.com
              - www.everlane.com
      - slug: treatmeant-c
        ratio: 1
        groups:
          - cfr
        value:
          id: EXPERIMENT_SHOPPING_TO_SOCIAL_ORGANIZE
          template: cfr_doorhanger
          groups:
            - cfr
          content:
            layout: addon_recommendation
            category: cfrAddons
            bucket_id: EXPERIMENT_SHOPPING_TO_SOCIAL_ORGANIZE
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            addon:
              id: "782160"
              title: Firefox Multi-Account Containers
              icon_dark_theme: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0Y5RjlGQSIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              icon: data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzBDMEMwRCIgZmlsbC1ydWxlPSJldmVub2RkIiBmaWxsLW9wYWNpdHk9Ii44Ij48cmVjdCB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHJ4PSIzIi8+PHJlY3QgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cmVjdCB4PSIyNiIgeT0iMjYiIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgcng9IjMiLz48cGF0aCBkPSJNMzggMGExIDEgMCAwIDEgMSAxdjhoOGExIDEgMCAwIDEgMSAxdjJhMSAxIDAgMCAxLTEgMWgtOHY4YTEgMSAwIDAgMS0xIDFoLTJhMSAxIDAgMCAxLTEtMXYtOGgtOGExIDEgMCAwIDEtMS0xdi0yYTEgMSAwIDAgMSAxLTFoOFYxYTEgMSAwIDAgMSAxLTFoMnoiLz48L2c+PC9zdmc+
              rating: 4.6
              users: 226263
              author: Mozilla Firefox
              amo_url: https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/
            text: Keep your online shopping, socializing and work lives separate with Firefox containers.
            buttons:
              primary:
                label:
                  value: Add the Extension
                  attributes:
                    accesskey: A
                action:
                  type: INSTALL_ADDON_FROM_URL
                  data:
                    url: null
                    telemetrySource: amo
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
                  action:
                    type: OPEN_PREFERENCES_PAGE
                    data:
                      category: general-cfraddons
          frequency:
            lifetime: 3
          targeting: (addonsInfo.addons|keys intersect ["@testpilot-containers"])|length == 0 && ((currentDate|date - profileAgeCreated) / 604800000) >= 1 && (topFrecentSites[.frecency > 100]|mapToProperty("host") intersect ["amazon.com","ebay.com","zillow.com","discord.com","craigslist.org","walmart.com","homedepot.com","etsy.com","target.com","roblox.com","wayfair.com","lowes.com","overstock.com","zappos.com","wish.com","sears.com","kohls.com","costco.com","everlane.com","www.amazon.com","www.ebay.com","www.zillow.com","www.discord.com","www.craigslist.org","www.walmart.com","www.homedepot.com","www.etsy.com","www.target.com","www.roblox.com","www.wayfair.com","www.lowes.com","www.overstock.com","www.zappos.com","www.wish.com","www.sears.com","www.kohls.com","www.costco.com","www.everlane.com"])|length && userPrefs.cfrAddons
          trigger:
            id: openURL
            params:
              - www.youtube.com
              - www.facebook.com
              - www.twitter.com
              - www.instagram.com
              - www.reddit.com
              - www.pinterest.com
              - www.linkedin.com
              - www.whatsapp.com
              - www.tiktok.com
              - www.messenger.com
              - www.tumblr.com
              - www.groupme.com
              - www.flickr.com
              - youtube.com
              - facebook.com
              - twitter.com
              - instagram.com
              - reddit.com
              - pinterest.com
              - linkedin.com
              - whatsapp.com
              - tiktok.com
              - messenger.com
              - tumblr.com
              - groupme.com
              - flickr.com
- id: MULTI-STAGE-ABOUTWELCOME-V2-79-RELEASE
  enabled: true
  filter_expression: env.version >= '79.' && env.version < '80.' && env.channel == 'release'
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: localeLanguageCode == "en" && [userId, "bug-1653032-message-multi-stage-aboutwelcome-v2-79-release-release-79-80"]|bucketSample(0, 2000, 10000) &&
    ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1653032-message-multi-stage-aboutwelcome-v2-79-release-release-79-80' in activeExperiments)
  arguments:
    slug: bug-1653032-message-multi-stage-aboutwelcome-v2-79-release-release-79-80
    userFacingName: "Multi-Stage About:Welcome V2 79 Release"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/multi-stage-aboutwelcome-v2-79-release/
    userFacingDescription: Study to validate Multi-stage onboarding experience.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: treatment-a
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-import
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                zap: true
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles:
                  type: topsites
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
      - slug: treatment-b
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-theme
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_CHOOSE_THEME"
              order: 1
              content:
                zap: true
                title: Choose a look
                subtitle: Personalize Firefox with a theme.
                tiles:
                  type: theme
                  action:
                    theme: <event>
                  data:
                    - theme: light
                      label: Light
                    - theme: dark
                      label: Dark
                primary_button:
                  label: Save Theme
                  action:
                    navigate: true
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
                    theme: default
      - slug: treatment-c
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-import-theme
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                zap: true
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles:
                  type: topsites
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
            - id: "AW_CHOOSE_THEME"
              order: 2
              content:
                zap: true
                title: Choose a look
                subtitle: Personalize Firefox with a theme.
                tiles:
                  type: theme
                  action:
                    theme: <event>
                  data:
                    - theme: light
                      label: Light
                    - theme: dark
                      label: Dark
                primary_button:
                  label: Save Theme
                  action:
                    navigate: true
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
                    theme: default
- id: MESSAGE_ROUTER_PICTURE_IN_PICTURE_CFR
  enabled: true
  filter_expression: env.channel == 'release' && env.version >= '78.' && env.version < '80.'
  # 5% of release
  targeting: |
    locale == 'en-US' && userPrefs.cfrFeatures &&
    platformName in ["win", "macosx"] &&
    'media.videocontrols.picture-in-picture.enabled'|preferenceValue &&
    [userId, 'messaging-experiments-cfr']|bucketSample(5312, 500, 10000) &&
    ((currentDate|date - profileAgeCreated) / 86400000) > 7 &&
    'app.shield.optoutstudies.enabled'|preferenceValue
  arguments:
    slug: bug-1658301-message-message-router-content-experiment-high-veloci-release-78-80
    branches:
      - slug: control
        ratio: 1
        value: {}
        groups:
          - cfr
      - slug: treatment-a-news
        ratio: 1
        groups:
          - cfr
        value:
          id: PIP_CFR_NEWS
          groups:
            - cfr-experiments
          content:
            bucket_id: PIP_CFR_NEWS
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/en-US/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    value: Remind Me Later
                    attributes:
                      accesskey: R
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Watch videos while you browse
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Keep yourself in the loop. With Picture-in-Picture you can watch the latest news while you visit other websites or apps - hover over a video and select the blue icon.
          frequency:
            # Per request, this experiment wants a larger lifetime frequency cap
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: "userPrefs.cfrFeatures"
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - news.yahoo.com
              - news.google.com
              - huffingtonpost.com
              - cnn.com
              - nytimes.com
              - foxnews.com
              - nbcnews.com
              - dailymail.co.uk
              - washingtonpost.com
              - theguardian.com
              - wsj.com
              - abcnews.go.com
              - news.bbc.co.uk
              - latimes.com
              - cnbc.com
              - weather.com
              - bloomberg.com
              - reuters.com
              - usatoday.com
              - nypost.com
              - forbes.com
              - chicagotribune.com
              - msn.com
              - npr.org
              - tmz.com
              - today.com
              - buzzfeed.com
      - slug: treatment-b-social-media
        ratio: 1
        groups:
          - cfr
        value:
          id: PIP_CFR_SOCIAL_MEDIA
          groups:
            - cfr-experiments
          content:
            bucket_id: PIP_CFR_SOCIAL_MEDIA
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/en-US/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    value: Remind Me Later
                    attributes:
                      accesskey: R
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Watch videos while you browse
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Wish you could watch videos shared by your friends and family as you browse the web? You can with Picture-in-Picture - hover over a video and select the blue icon.
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: "userPrefs.cfrFeatures"
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - facebook.com
              - twitter.com
              - linkedin.com
              - instagram.com
              - tumblr.com
              - reddit.com
              - pinterest.com
      - slug: treatment-c-entertainment
        ratio: 1
        groups:
          - cfr
        value:
          id: PIP_CFR_ENTERTAINMENT
          groups:
            - cfr-experiments
          content:
            bucket_id: PIP_CFR_ENTERTAINMENT
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/en-US/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    value: Remind Me Later
                    attributes:
                      accesskey: R
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Watch videos while you browse
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Binge watch your favorite shows guilt-free with Picture-in-Picture - hover over a video and select the blue icon.
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: "userPrefs.cfrFeatures"
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - youtube.com
              - netflix.com
              - vimeo.com
              - twitch.com
              - dailymotion.com
              - hulu.com
              - ustream.com
              - metacafe.com
              - espn.com/watch
              - disneyplus.com
              - play.hbogo.com
              - primevideo.com
      - slug: treatment-d-informational
        ratio: 1
        groups:
          - cfr
        value:
          id: PIP_CFR_INFORMATIONAL
          groups:
            - cfr-experiments
          content:
            bucket_id: PIP_CFR_INFORMATIONAL
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/en-US/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    value: Remind Me Later
                    attributes:
                      accesskey: R
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Watch videos while you browse
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Picture-in-Picture lets you browse and watch videos at the same time - hover over a video and select the blue icon.
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: "userPrefs.cfrFeatures"
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - news.yahoo.com
              - news.google.com
              - huffingtonpost.com
              - cnn.com
              - nytimes.com
              - foxnews.com
              - nbcnews.com
              - dailymail.co.uk
              - washingtonpost.com
              - theguardian.com
              - wsj.com
              - abcnews.go.com
              - news.bbc.co.uk
              - latimes.com
              - cnbc.com
              - weather.com
              - bloomberg.com
              - reuters.com
              - usatoday.com
              - nypost.com
              - forbes.com
              - chicagotribune.com
              - msn.com
              - npr.org
              - tmz.com
              - today.com
              - buzzfeed.com
              - facebook.com
              - twitter.com
              - linkedin.com
              - instagram.com
              - tumblr.com
              - reddit.com
              - pinterest.com
              - youtube.com
              - netflix.com
              - vimeo.com
              - twitch.com
              - dailymotion.com
              - hulu.com
              - ustream.com
              - metacafe.com
              - espn.com/watch
              - disneyplus.com
              - play.hbogo.com
              - primevideo.com
    userFacingName: Recommend Picture-in-Picture CFR
    isEnrollmentPaused: true
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/message-router-content-experiment-high-velocity-message-testing-cfr-to-pip/
    userFacingDescription: "Message Router Content Experiment: High Velocity Message Testing: CFR to PiP"
- id: "PRIVACY-RETENTION-STUDY-V2-BUG-1656311"
  enabled: true
  filter_expression: env.channel == 'release' && env.version >= '79.'
  # 50% of release
  targeting: localeLanguageCode == 'en' && [userId, "messaging-experiments-cfr"]|bucketSample(311, 5311, 10000) && 'app.shield.optoutstudies.enabled'|preferenceValue && ((currentDate|date - profileAgeCreated) / 86400000) <= 14
  arguments:
    slug: bug-1656311-message-high-velocity-message-testing-privacy-retenti-release-79-80
    userFacingName: Message Router Content Experiment High Velocity Message Testing Privacy Retention Study V2
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/high-velocity-message-testing-privacy-retention-study-v2/
    userFacingDescription: This measures retention changes across some privacy pages including the Protections Dashboard, and Mozilla's Privacy Promise.
    isEnrollmentPaused: true
    branches:
      - slug: cfr-to-privacy-promise
        ratio: 1
        groups:
          - cfr
        value:
          id: PRIVACY_RETENTION_PRIVACY
          template: cfr_doorhanger
          content:
            layout: icon_and_message
            category: cfrFeatures
            anchor_id: tracking-protection-icon-box
            skip_address_bar_notifier: true
            persistent_doorhanger: true
            bucket_id: PRIVACY_RETENTION_PRIVACY
            heading_text: Putting your privacy before profits
            notification_text: ''
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            text: You’re using the only major browser backed by a non-profit. See how Firefox puts your privacy first.
            icon: chrome://browser/content/logos/tracking-protection.svg
            icon_dark_theme: chrome://browser/content/logos/tracking-protection-dark-theme.svg
            buttons:
              primary:
                label:
                  value: Show Me
                  attributes:
                    accesskey: S
                action:
                  type: OPEN_URL
                  data:
                    args: https://www.mozilla.org/firefox/privacy/?utm_source=firefox-desktop&utm_campaign=hvt-privacy-retention-v2&utm_medium=referral
                    where: tab
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
          targeting: recentVisits|length > 1 && userPrefs.cfrFeatures
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          trigger:
            id: frequentVisits
            patterns:
              - http://*/*
              - https://*/*
      - slug: cfr-to-protections-dashboard
        ratio: 1
        groups:
          - cfr
        value:
          id: PRIVACY_RETENTION_PROTECTION_REPORT
          template: cfr_doorhanger
          content:
            layout: icon_and_message
            category: cfrFeatures
            anchor_id: tracking-protection-icon-box
            skip_address_bar_notifier: true
            persistent_doorhanger: true
            bucket_id: PRIVACY_RETENTION_PROTECTION_REPORT
            heading_text: Putting your privacy before profits
            notification_text: ''
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            text: You’re using the only major browser backed by a non-profit. See how Firefox puts your privacy first.
            icon: chrome://browser/content/logos/tracking-protection.svg
            icon_dark_theme: chrome://browser/content/logos/tracking-protection-dark-theme.svg
            buttons:
              primary:
                label:
                  value: Show Me
                  attributes:
                    accesskey: S
                action:
                  type: OPEN_PROTECTION_REPORT
              secondary:
                - label:
                    string_id: cfr-doorhanger-extension-cancel-button
                  action:
                    type: CANCEL
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
          frequency:
            lifetime: 3
            custom: [{period: 86400000, cap: 1}]
          targeting: recentVisits|length > 1 && userPrefs.cfrFeatures
          trigger:
            id: frequentVisits
            patterns:
              - http://*/*
              - https://*/*
- id: XMAN-MOMENTS-PAGE-80-NIGHTLY
  # Do *not* publish to production. This message is used for dev and QA only
  enabled: true
  filter_expression: env.version >= '80.' && env.version < '81.' && (env.channel == 'nightly' || env.channel == 'default')
  targeting: localeLanguageCode == "en"
  arguments:
    slug: xman-moments-page-80-nightly
    userFacingName: "Moments Page Test: Nightly 80"
    userFacingDescription: "Moments page test"
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - moments-page
        value: {}
      - slug: treatment
        ratio: 1
        groups:
          - moments-page
        value:
          id: XMAN_MOMENTS_TEST
          groups: [moments-pages]
          content:
            action:
              data:
                expireDelta: 604800000
                url: https://www.mozilla.org/firefox/welcome/1/
              id: moments-wnp
            bucket_id: XMAN_MOMENTS_TEST
          targeting: "true"
          template: update_action
          trigger:
            id: momentsUpdate
- id: MULTI-STAGE-ABOUTWELCOME-V3-80-RELEASE
  enabled: true
  filter_expression: env.version >= '80.' && env.version < '81.' && env.channel == 'release'
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: localeLanguageCode == "en" && [userId, "bug-1655173-message-multi-stage-aboutwelcome-v3-80-release-release-80-81"]|bucketSample(0, 4000, 10000) &&
    ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1655173-message-multi-stage-aboutwelcome-v3-80-release-release-80-81' in activeExperiments)
  arguments:
    slug: bug-1655173-message-multi-stage-aboutwelcome-v3-80-release-release-80-81
    userFacingName: "Multi-Stage About:Welcome V3 80 Release"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/multi-stage-aboutwelcome-v3-80-release/
    userFacingDescription: Study to validate Multi-stage onboarding experience.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: null
      - slug: treatment-import
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: msw-import
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                zap: true
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles:
                  type: topsites
                  info: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
      - slug: treatment-theme
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: msw-theme
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_CHOOSE_THEME"
              order: 1
              content:
                zap: true
                title: Choose a look
                subtitle: Personalize Firefox with a theme.
                tiles:
                  type: theme
                  action:
                    theme: <event>
                  data:
                    - theme: automatic
                      label: Automatic
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-automatic
                    - theme: light
                      label: Light
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-light
                    - theme: dark
                      label: Dark
                      tooltip:
                        string_id: onboarding-multistage-theme-tooltip-dark
                primary_button:
                  label: Save Theme
                  action:
                    navigate: true
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
                    theme: automatic
      - slug: treatment-privacy
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: msw-privacy
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                zap: true
                title: Welcome to Firefox
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_PRIVACY"
              order: 1
              content:
                title: Automatic Privacy
                subtitle: Firefox automatically blocks trackers and malware, and keeps companies from secretly following you around. When you see the shield while browsing, Firefox is protecting you.
                tiles:
                  type: video
                  media_type: privacy
                  source:
                    default: resource://activity-stream/data/content/assets/privacy-onboarding.webm
                    dark: resource://activity-stream/data/content/assets/privacy-onboarding-dark.webm
                primary_button:
                  label: Start Browsing
                  action:
                    navigate: true
- id: XMAN-MOMENTS-PAGE-80-NIGHTLY
  # Do *not* publish to production. This message is used for dev and QA only
  enabled: true
  filter_expression: env.version >= '80.' && env.version < '81.' && (env.channel == 'nightly' || env.channel == 'default')
  targeting: localeLanguageCode == "en"
  arguments:
    slug: xman-moments-page-80-nightly
    userFacingName: "Moments Page Test: Nightly 80"
    userFacingDescription: "Moments page test"
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - moments-page
        value: {}
      - slug: treatment
        ratio: 1
        groups:
          - moments-page
        value:
          id: XMAN_MOMENTS_TEST
          groups: [moments-pages]
          content:
            action:
              data:
                expireDelta: 604800000
                url: https://www.mozilla.org/firefox/welcome/1/
              id: moments-wnp
            bucket_id: XMAN_MOMENTS_TEST
          targeting: "true"
          template: update_action
          trigger:
            id: momentsUpdate
