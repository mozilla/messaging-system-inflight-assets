- id: MULTISTAGE_ABOUT_WELCOME_TEST
  enabled: true
  filter_expression: env.version >= '78.' && env.version < '80.'
  targeting: localeLanguageCode == "en" &&
    firefoxVersion >= 78 &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'multistage_aboutwelcome_test' in activeExperiments)
  arguments:
    slug: multistage_aboutwelcome_test
    userFacingName: "About:Welcome MultiStage Welcome Test"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/
    userFacingDescription: Test study to validate launching multistage welcome flow via experiment framework.
    isEnrollmentPaused: false
    branches:
      - slug: multistage_aboutwelcome_test_control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: multistage_aboutwelcome_test_treatment
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
- id: AW_PULL_FACTOR_PRIVACY_1
  enabled: true
  filter_expression: ('76' in env.version) || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_1"]|bucketSample(0,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_1' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_1
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW

- id: AW_PULL_FACTOR_PRIVACY_2
  enabled: true
  filter_expression: ('76' in env.version) || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_2"]|bucketSample(0,
    2000, 10000) &&
    !(((currentDate|date - profileAgeCreated) / 86400000) > 1) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_2' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_2
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: true
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
- id: AW_PULL_FACTOR_PRIVACY_3
  enabled: true
  filter_expression: ('76' in env.version && env.channel == 'beta' &&
    !(env.telemetry.main.environment.profile.creationDate < ('2020-04-28'|date / 1000 / 60 / 60 / 24)))
    || (localeLanguageCode == "en" &&
    firefoxVersion >= 76 && [userId, "aw_pull_factor_privacy_3"]|bucketSample(0,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'aw_pull_factor_privacy_3' in activeExperiments))
  arguments:
    slug: aw_pull_factor_privacy_3
    userFacingName: "About:Welcome Pull Factor Reinforcement"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/aboutwelcome-pull-factor-reinforcement/
    userFacingDescription: This study uses 4 different variants of about:welcome with a goal of testing new experiment framework and get insights on whether reinforcing pull-factors improves retention.
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: variant_1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-personal-data-promise-title
                text:
                  string_id: onboarding-personal-data-promise-text
                icon: pledge
                primary_button:
                  label:
                    string_id: onboarding-personal-data-promise-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://www.mozilla.org/firefox/privacy/
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: variant_3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          title: Welcome to Firefox. Fast, safe, private.
          cards:
            - id: TRAILHEAD_CARD_2
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
- id: CFR_XMAN_SMOKE_TEST
  enabled: true
  targeting: localeLanguageCode == 'en' &&
    firefoxVersion >= 77 && [userId, 'cfr_xman_smoke_test']|bucketSample(0, 2000, 10000)
  filter_expression: env.channel == 'nightly'
  arguments:
    slug: cfr_xman_smoke_test
    userFacingName: CFR X-Man smoke test
    userFacingDescription: Test X-Man ability to deploy CFR experiments
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - cfr
        value:
          id: FACEBOOK_CONTAINER_3_72
          content:
            addon:
              amo_url: https://addons.mozilla.org/firefox/addon/facebook-container/
              author: Mozilla
              icon: resource://activity-stream/data/content/assets/cfr_fb_container.png
              id: '954390'
              rating: 4.5
              title: Facebook Container
              users: 1455872
            bucket_id: CFR_M1
            buttons:
              primary:
                action:
                  data:
                    url: null
                  type: INSTALL_ADDON_FROM_URL
                label:
                  string_id: cfr-doorhanger-extension-ok-button
                secondary:
                  - action:
                      type: CANCEL
                    label:
                      string_id: cfr-doorhanger-extension-cancel-button
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - action:
                      data:
                        category: general-cfraddons
                        origin: CFR
                      type: OPEN_PREFERENCES_PAGE
                    label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrAddons
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            text: Stop Facebook from tracking your activity across the web. Use Facebook the
              way you normally do without annoying ads following you around.
          frequency:
            lifetime: 3
          targeting: localeLanguageCode == 'en' &&  (xpinstallEnabled == true) &&
            (['@contain-facebook','{bb1b80be-e6b3-40a1-9b6e-9d4073343f0b}',
            '{a50d61ca-d27b-437a-8b52-5fd801a0a88b}'] intersect addonsInfo.addons|keys)|length == 0 &&
            (['www.facebook.com','facebook.com','messenger.com','www.messenger.com',
            'instagram.com','www.instagram.com','whatsapp.com','www.whatsapp.com','web.whatsapp.com']
            intersect topFrecentSites[.frecency >= 5000]|mapToProperty('host'))|length > 0 && userPrefs.cfrAddons
          priority: 5
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - www.facebook.com
              - facebook.com
              - www.instagram.com
              - instagram.com
              - www.whatsapp.com
              - whatsapp.com
              - web.whatsapp.com
              - www.messenger.com
              - messenger.com
      - slug: variant_1
        ratio: 1
        groups:
          - cfr
        value:
          id: FACEBOOK_CONTAINER_3_72
          content:
            addon:
              amo_url: https://addons.mozilla.org/firefox/addon/facebook-container/
              author: Mozilla
              icon: resource://activity-stream/data/content/assets/cfr_fb_container.png
              id: '954390'
              rating: 4.5
              title: Facebook Container
              users: 1455872
            bucket_id: CFR_M1
            buttons:
              primary:
                action:
                  data:
                    url: null
                  type: INSTALL_ADDON_FROM_URL
                label:
                  string_id: cfr-doorhanger-extension-ok-button
                secondary:
                  - action:
                      type: CANCEL
                    label:
                      string_id: cfr-doorhanger-extension-cancel-button
                  - label:
                      string_id: cfr-doorhanger-extension-never-show-recommendation
                  - action:
                      data:
                        category: general-cfraddons
                        origin: CFR
                      type: OPEN_PREFERENCES_PAGE
                    label:
                      string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrAddons
            heading_text:
              string_id: cfr-doorhanger-extension-heading
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            notification_text:
              string_id: cfr-doorhanger-extension-notification2
            text: Stop Facebook from tracking your activity across the web. Use Facebook the
              way you normally do without annoying ads following you around.
          frequency:
            lifetime: 3
          targeting: localeLanguageCode == 'en' &&  (xpinstallEnabled == true) &&
            (['@contain-facebook','{bb1b80be-e6b3-40a1-9b6e-9d4073343f0b}',
            '{a50d61ca-d27b-437a-8b52-5fd801a0a88b}'] intersect addonsInfo.addons|keys)|length == 0 &&
            (['www.facebook.com','facebook.com','messenger.com','www.messenger.com',
            'instagram.com','www.instagram.com','whatsapp.com','www.whatsapp.com','web.whatsapp.com']
            intersect topFrecentSites[.frecency >= 5000]|mapToProperty('host'))|length > 0 && userPrefs.cfrAddons
          priority: 5
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - www.facebook.com
              - facebook.com
              - www.instagram.com
              - instagram.com
              - www.whatsapp.com
              - whatsapp.com
              - web.whatsapp.com
              - www.messenger.com
              - messenger.com
- id: RECOMMEND_PICTURE_IN_PICTURE_CFR
  enabled: true
  arguments:
    slug: bug-1635199-message-recommend-picture-in-picture-cfr-beta-77-77
    branches:
      - slug: n4s_pip_control
        ratio: 50
        value: {}
        groups:
          - cfr
      - slug: n4s_pip_cfr
        ratio: 50
        groups:
          - cfr
        value:
          id: N4S_PIP_CFR_MESSSAGE
          content:
            bucket_id: N4S_PIP_CFR_MESSSAGE
            buttons:
              primary:
                action:
                  data:
                    args: https://support.mozilla.org/kb/about-picture-picture-firefox
                    where: tabshifted
                  type: OPEN_URL
                label:
                  value: Learn More
                  attributes:
                    accesskey: L
              secondary:
                - action:
                    type: CANCEL
                  label:
                    string_id: cfr-doorhanger-extension-cancel-button
                - label:
                    string_id: cfr-doorhanger-extension-never-show-recommendation
                - action:
                    data:
                      category: general-cfrfeatures
                    type: OPEN_PREFERENCES_PAGE
                  label:
                    string_id: cfr-doorhanger-extension-manage-settings-button
            category: cfrFeatures
            heading_text: Multitask with Picture-in-Picture
            icon: chrome://global/skin/media/pictureinpicture.svg
            info_icon:
              label:
                string_id: cfr-doorhanger-extension-sumo-link
              sumo_path: extensionrecommendations
            layout: icon_and_message
            notification_text:
              string_id: cfr-doorhanger-extension-notification
            text: Pop video into a floating window to keep watching while you work in other tabs. Hover over any video and select the small blue rectangle that appears.
          frequency:
            lifetime: 3
          targeting: 'true'
          template: cfr_doorhanger
          trigger:
            id: openURL
            params:
              - youtube.com
              - netflix.com
              - vimeo.com
              - twitch.tv
              - dailymotion.com
              - hulu.com
              - ustream.com
              - metacafe.com
              - disneyplus.com
              - www.youtube.com
              - www.netflix.com
              - www.vimeo.com
              - www.twitch.tv
              - www.dailymotion.com
              - www.hulu.com
              - www.ustream.com
              - www.metacafe.com
              - www.disneyplus.com
    isHighVolume: false
    userFacingName: Recommend Picture-in-Picture CFR
    isEnrollmentPaused: true
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/recommend-picture-in-picture-cfr/
    userFacingDescription: If we introduce PiP via CFR for users visiting video sites frequently, then we will see more adoption of the PiP feature because we have observed the feature is not easily discovered via user research observations.
  filter_expression: env.version >= '77.' && env.version < '78.'
  targeting: |
    locale == 'en-US' && userPrefs.cfrFeatures && firefoxVersion == 77 &&
    browserSettings.update.channel == 'beta' &&
    'media.videocontrols.picture-in-picture.video-toggle.enabled'|preferenceValue &&
    [userId, 'n4s-workweek']|bucketSample(0, 500, 10000)
- id: PRIVACY-PROTECTIONS-REPORT-ONBOARDING-N4S
  enabled: true
  filter_expression: env.version >= '77.' && env.version < '78.' && env.channel == 'beta' &&
    !(env.telemetry.main.environment.profile.creationDate < ('2020-05-06'|date / 1000 / 60 / 60 / 24))
  targeting: locale == 'en-US' && [userId, "n4s-workweek"]|bucketSample(2500,
    2000, 10000) &&
    (!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue) || 'bug-1635870-message-privacy-protections-report-onboarding-n4s-beta-76-77' in activeExperiments)
  arguments:
    slug: bug-1635870-message-privacy-protections-report-onboarding-n4s-beta-76-77
    userFacingName: "Privacy Protections Report Onboarding (N4S)"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/privacy-protections-report-onboarding-n4s/
    userFacingDescription: This experiment will compare a treatment branch with the default onboarding experience, to a set of treatments with a new protection report card.
    isEnrollmentPaused: true
    branches:
      - slug: n4s_protections_report_control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: n4s_protections_report_position1
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_4
              content:
                title:
                  string_id: onboarding-browse-privately-title
                text:
                  string_id: onboarding-browse-privately-text
                icon: private
                primary_button:
                  label:
                    string_id: onboarding-browse-privately-button
                  action:
                    type: OPEN_PRIVATE_BROWSER_WINDOW
      - slug: n4s_protections_report_position2
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: "https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead"
                      where: tabshifted
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
      - slug: n4s_protections_report_position3
        ratio: 1
        groups:
          - aboutwelcome
        value:
          cards:
            - id: TRAILHEAD_CARD_12
              content:
                title:
                  string_id: onboarding-data-sync-title
                text:
                  string_id: onboarding-data-sync-text2
                icon: devices
                primary_button:
                  label:
                    string_id: onboarding-data-sync-button2
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: "https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead"
                      where: tabshifted
            - id: TRAILHEAD_CARD_3
              content:
                title:
                  string_id: onboarding-firefox-monitor-title
                text:
                  string_id: onboarding-firefox-monitor-text2
                icon: ffmonitor
                primary_button:
                  label:
                    string_id: onboarding-firefox-monitor-button
                  action:
                    type: OPEN_URL
                    data:
                      args: https://monitor.firefox.com/
                      where: tabshifted
            - id: TRAILHEAD_CARD_13
              content:
                title: Private by Default
                text: Firefox’s default privacy and security settings block malware and keep companies from following your every move.
                icon: tracking
                primary_button:
                  label: Learn More
                  action:
                    type: OPEN_URL
                    data:
                      args: https://support.mozilla.org/kb/enhanced-tracking-protection-firefox-desktop
                      where: tabshifted
- id: MULTI-STAGE-ABOUTWELCOME-V1-78-BETA-V2
  enabled: true
  filter_expression: env.version >= '78.' && env.version < '79.' && env.channel == 'beta' && env.appinfo.appBuildID >= '20200611192304'
  # The filter `!('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)` is used to exclude
  # users who have switched channels or re-installed the browser without having a new profile
  targeting: localeLanguageCode == "en" && [userId, "bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79"]|bucketSample(0, 5000, 10000) &&
    ((isFirstStartup && !('trailhead.firstrun.didSeeAboutWelcome'|preferenceValue)) || 'bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79' in activeExperiments)
  arguments:
    slug: bug-1644521-message-multi-stage-aboutwelcome-v1-78-beta-v2-beta-78-79
    userFacingName: "About:Welcome MultiStage Welcome Beta"
    experimentDocumentUrl: https://experimenter.services.mozilla.com/experiments/multi-stage-aboutwelcome-v1-78-beta-v2/
    userFacingDescription: Study to validate launching multistage welcome flow via experiment framework.
    isEnrollmentPaused: false
    branches:
      - slug: control
        ratio: 1
        groups:
          - aboutwelcome
        value: {}
      - slug: treatment-static
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
      - slug: treatment-dynamic
        ratio: 1
        groups:
          - aboutwelcome
        value:
          id: multi-stage-welcome-importable
          template: multistage
          screens:
            - id: "AW_GET_STARTED"
              order: 0
              content:
                title:
                  string_id: onboarding-welcome-header
                subtitle: The fast, safe, and private browser that's backed by a non-profit.
                primary_button:
                  label: Start Setup
                  action:
                    navigate: true
                secondary_button:
                  text: Have an account?
                  label: Sign in
                  position: top
                  action:
                    type: OPEN_URL
                    addFlowParams: true
                    data:
                      args: https://accounts.firefox.com/?service=sync&action=email&context=fx_desktop_v3&entrypoint=activity-stream-firstrun&style=trailhead
                      where: current
            - id: "AW_IMPORT_SETTINGS"
              order: 1
              content:
                title: Import your passwords, bookmarks, and more
                subtitle: Coming from another browser? It's easy to bring everything to Firefox.
                tiles: true
                primary_button:
                  label: Start Import
                  action:
                    navigate: true
                    type: SHOW_MIGRATION_WIZARD
                secondary_button:
                  label: Not now
                  action:
                    navigate: true
